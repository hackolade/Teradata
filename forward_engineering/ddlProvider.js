"use strict";var he=Object.defineProperty;var c=(d,b)=>he(d,"name",{value:b,configurable:!0});var V=(d,b)=>()=>(b||d((b={exports:{}}).exports,b),b.exports);var ne=V((He,te)=>{"use strict";te.exports={createDatabase:'CREATE DATABASE "${name}" AS ${databaseOptions};',createSession:'SET SESSION DATABASE "${name}";',columnDefinition:'"${name}" ${type}${inlineLength}${not_null}${uppercase}${caseSpecific}${format}${default}${storageFormat}${characterSet}${withSchema}${autoColumn}${compress}${compressUsing}${decompressUsing}${inlineCheckConstraint}${inlineUniqueConstraint}${inlinePKConstraint}',createTable:"CREATE${tableSet}${temporary}${traceTable} TABLE ${name}${tableOptions} (\n		${column_definitions}${keyConstraints}${checkConstraints}${foreignKeyConstraints}\n	)${tableIndexes}${tablePreservation};\n",createAsSelectTable:"CREATE${tableSet}${temporary} TABLE ${name}${tableOptions} (\n		${column_definitions}${keyConstraints}${checkConstraints}${foreignKeyConstraints}\n	)\n	AS (\n	${selectStatement} \n	)${tableIndexes}${tablePreservation};\n",createErrorTable:"CREATE ERROR TABLE ${tableName} FOR ${targetDataTable};\n",createForeignTable:"CREATE FOREIGN TABLE ${name}${tableOptions} (\n		${column_definitions}${keyConstraints}${checkConstraints}${foreignKeyConstraints}\n	)\n	USING (\n	${usingOptions}\n	)${tableIndexes}${tablePreservation};\n",createHashIndex:"CREATE HASH INDEX ${indexName}${indexOptions} (\n		${indexKeys}\n	)\n	ON ${tableName}${orderBy};\n",createJoinIndex:"CREATE JOIN INDEX ${indexName}${indexOptions}\n	AS ${selectStatement};\n",createKeyConstraint:"CONSTRAINT ${constraintName}${constraintType}${columns}",checkConstraint:"${name}${expression}",createForeignKeyConstraint:"FOREIGN KEY (${foreignKey}) REFERENCES ${checkOption} ${primaryTable} (${primaryKey})",createView:"CREATE${recursive} VIEW ${name} (\n	${columnList}\n)\nAS ${selectStatement};\n",viewSelectStatement:"SELECT ${keys}\n	FROM ${tableName}",createStructuredType:`CREATE TYPE \${typeName} AS (
	\${columnDefinitions}
)
NOT FINAL\${methodSpecification};
`,createDistinctType:"CREATE TYPE ${typeName} AS ${baseType} FINAL${methodSpecification};\n",createArrayType:"CREATE TYPE ${typeName} AS ${baseType}${default};\n",dropDatabase:'DROP DATABASE "${databaseName}";\n',modifyDatabase:'MODIFY DATABASE "${databaseName}" AS ${databaseOptions};\n',dropTable:"DROP ${temporary}TABLE ${name};\n",alterTable:"ALTER TABLE ${tableName}${tableOptions}${alterStatement};",addColumn:" ADD ${columnDefinition}",dropColumn:" DROP ${name}",rename:" RENAME ${oldName} TO ${newName}",dropCheckConstraint:" DROP CONSTRAINT ${name} CHECK",addCheckConstraint:" ADD CONSTRAINT ${name} ${expression}",modifyCheckConstraint:" MODIFY CONSTRAINT ${name} ${expression}",dropSecondaryIndex:"DROP INDEX ${indexName} ON ${tableName};",dropIndex:"DROP${indexType} INDEX ${indexName};",dropView:"DROP VIEW ${viewName};",renameView:"RENAME VIEW ${oldViewName} TO ${newViewName};"}});var ae=V((ke,re)=>{"use strict";re.exports={number:"NUMBER",string:"TEXT",date:"DATE",timestamp:"TIMESTAMP",binary:"BYTE",boolean:"NUMBER",document:"OBJECT",array:"ARRAY",objectId:"VARCHAR(24)",default:"CHAR"}});var ie=V((Je,se)=>{"use strict";se.exports={BYTEINT:{capacity:1},SMALLINT:{capacity:2},INT:{capacity:4},INTEGER:{capacity:4},BIGINT:{capacity:8},DECIMAL:{mode:"decimal"},DEC:{mode:"decimal"},NUMERIC:{mode:"decimal"},FLOAT:{capacity:4,mode:"float"},"DOUBLE PRECISION":{capacity:8,mode:"float"},REAL:{capacity:8,mode:"float"},NUMBER:{mode:"number"},CHAR:{mode:"char"},CHARACTER:{mode:"char"},VARCHAR:{mode:"varchar"},"CHAR VARYING":{mode:"varchar"},"CHARACTER VARYING":{mode:"varchar"},"LONG VARCHAR":{mode:"long varchar"},VARGRAPHIC:{mode:"vargraphic"},"LONG VARGRAPHIC":{mode:"long vargraphic"},CLOB:{mode:"clob"},"CHARACTER LARGE OBJECT":{mode:"clob"},BYTE:{mode:"byte"},VARBYTE:{mode:"varbyte"},BLOB:{mode:"blob"},DATE:{format:"YYYY-MM-DD"},TIME:{format:"hh:mm:ss"},TIMESTAMP:{format:"YYYY-MM-DD hh:mm:ss"},ST_Geometry:{mode:"ST_Geometry"},MBR:{mode:"MBR"},MBB:{mode:"MBB"},JSON:{},XML:{},XMLTYPE:{},DATASET:{},PERIOD:{},"INTERVAL YEAR":{},"INTERVAL MONTH":{},"INTERVAL DAY":{},"INTERVAL HOUR":{},"INTERVAL MINUTE":{},"INTERVAL SECOND":{}}});var ce=V((je,oe)=>{"use strict";var Ke=c(d=>Array.isArray(d)?d.reduce((b,L)=>({...b,[L.id]:L.value}),{}):{},"getAdditionalOptions");oe.exports=Ke});var de=V((ze,le)=>{"use strict";var Me=c(({commentIfDeactivated:d})=>(b,L)=>{let p=!1;return{...L,...["dropDatabase","dropTable","dropColumn","dropIndex","dropCheckConstraint","dropView"].reduce((E,P)=>({...E,[P]:(...N)=>{let f=L[P](...N);return p=p||!!f,b||!f?f:d(f,{isActivated:!1})}}),{}),isDropInStatements(){return p}}},"dropStatementProxy");le.exports=Me});var Ee=V((We,me)=>{"use strict";var ve=c(({index:d,numberOfStatements:b,lastIndexOfActivatedStatement:L,delimiter:p})=>{let E=d===b-1,P=d===L;return E?"":P?" --"+p:p},"getDelimiter"),Fe=c(({statements:d=[],delimiter:b=",",indent:L=`
`})=>{let p=d.findLastIndex(P=>!P.startsWith("--")),E=d.length;return d.map((P,N)=>{let f=ve({index:N,numberOfStatements:E,lastIndexOfActivatedStatement:p,delimiter:b});return P+f}).join(L)},"joinActivatedAndDeactivatedStatements");me.exports={joinActivatedAndDeactivatedStatements:Fe}});var Te=V((Qe,Ae)=>{"use strict";Ae.exports=({_:d,commentIfDeactivated:b,checkAllKeysDeactivated:L,divideIntoActivatedAndDeactivated:p,assignTemplates:E})=>({generateConstraintsString:c(($,M)=>{let m=b(($?.deactivatedItems||[]).join(`,
		`),{isActivated:!M,isPartOfLine:!0}),A=$?.activatedItems?.length?`,
		`+$.activatedItems.join(`,
		`):"",u=$?.deactivatedItems?.length?`
		`+m:"";return A+u},"generateConstraintsString"),foreignKeysToString:c($=>{if(Array.isArray($)){let M=$.filter(u=>d.get(u,"isActivated",!0)).map(u=>`"${d.trim(u.name)}"`),m=$.filter(u=>!d.get(u,"isActivated",!0)).map(u=>`"${d.trim(u.name)}"`),A=m.length?b(m,{isActivated:!1,isPartOfLine:!0}):"";return M.join(", ")+A}return $},"foreignKeysToString"),foreignActiveKeysToString:c($=>$.map(M=>d.trim(M.name)).join(", "),"foreignActiveKeysToString"),createKeyConstraint:c(($,M)=>m=>{let A=c(({name:B})=>`"${B}"`,"columnMapToString"),u=L(m.columns),r=p(m.columns,A),o=r?.deactivatedItems?.length?b(r.deactivatedItems.join(", "),{isActivated:!1,isPartOfLine:!0}):"",S=!u&&M?" ("+r.activatedItems.join(", ")+o+")":" ("+m.columns.map(A).join(", ")+")";return{statement:E($.createKeyConstraint,{constraintName:m.name?`"${d.trim(m.name)}" `:"",constraintType:m.keyType,columns:S}),isActivated:!u}},"createKeyConstraint")})});var pe=V((et,ue)=>{"use strict";ue.exports=(d,b)=>{let L=c((r,o)=>Object.entries(r.properties).map(o),"mapProperties"),p=c(r=>r.compositeUniqueKey?!1:!!r.unique,"isUniqueKey"),E=c(r=>r.compositeUniqueKey||r.compositePrimaryKey?!1:!!r.primaryKey,"isPrimaryKey"),P=c(r=>p(r)&&d.isEmpty(r.uniqueKeyConstraintName),"isInlineUnique"),N=c(r=>E(r)&&d.isEmpty(r.primaryKeyConstraintName),"isInlinePrimaryKey"),f=c((r,o,S,B)=>b({keyType:o,name:r,columns:[{name:S,isActivated:B}]}),"hydrateKeyConstraintOptions"),v=c((r,o)=>Object.keys(o).find(S=>o[S].GUID===r),"findName"),$=c((r,o)=>d.get(Object.values(o).find(S=>S.GUID===r),"isActivated",!0),"checkIfActivated"),M=c((r,o)=>d.map(r,S=>({name:v(S.keyId,o.properties),isActivated:$(S.keyId,o.properties)})),"getKeys"),m=c(r=>Array.isArray(r.primaryKey)?r.primaryKey.filter(o=>!d.isEmpty(o.compositePrimaryKey)).map(o=>({...f(o.constraintName,"PRIMARY KEY",null,r),columns:M(o.compositePrimaryKey,r)})):[],"getCompositePrimaryKeys"),A=c(r=>Array.isArray(r.uniqueKey)?r.uniqueKey.filter(o=>!d.isEmpty(o.compositeUniqueKey)).map(o=>({...f(o.constraintName,"UNIQUE",null,r),columns:M(o.compositeUniqueKey,r)})):[],"getCompositeUniqueKeys");return{getTableKeyConstraints:c(r=>{if(!r.properties)return[];let o=L(r,([B,O])=>{if(!(!E(O)||d.isEmpty(O.primaryKeyConstraintName)))return f(O.primaryKeyConstraintName,"PRIMARY KEY",B,O.isActivated)}).filter(Boolean),S=d.flatten(L(r,([B,O])=>{if(!(!p(O)||d.isEmpty(O.uniqueKeyConstraintName)))return f(O.uniqueKeyConstraintName,"UNIQUE",B,O.isActivated)})).filter(Boolean);return[...o,...m(r),...S,...A(r)]},"getTableKeyConstraints"),isInlineUnique:P,isInlinePrimaryKey:N}}});var Ce=V((nt,Se)=>{"use strict";Se.exports=(d,b,L)=>{let p=c((A,u)=>{if(!u)return A.map(S=>`"${S.name}"`).join(`,
	`);let r=A.filter(S=>S.isActivated).map(S=>`"${S.name}"`),o=A.filter(S=>!S.isActivated).map(S=>`"${S.name}"`);return r.length===0?L(o.join(`,
	`),{isActivated:!1},!0):o.length===0?r.join(`,
	`):r.join(`,
	`)+`
	`+L(o.join(`,
	`),{isActivated:!1},!0)},"viewColumnsToString"),E=c((A,u)=>u?`"${u}"."${A}"`:`"${A}"`,"getTableName"),P=E,N=c((A,u)=>A?`"${A}"."${u}"`:u,"getDefaultJournalTableName"),f=c((A,u)=>A===u?`${u} JOURNAL`:`${A} ${u} JOURNAL`,"getJournalingStrategy"),v=c(({db_account:A,db_default_map:u,db_permanent_storage_size:r,spool_files_size:o,has_fallback:S,db_before_journaling_strategy:B,db_after_journaling_strategy:O,db_default_journal_table:w,db_default_journal_db:j,dropDefaultJournalTable:q})=>{let G=c((H,ee,i=!1)=>l=>H?[...l,ee]:i?[...l,i]:l,"add"),z=`${q?"DROP ":""}DEFAULT JOURNAL TABLE = ${N(j,w)}`;return d.flow([G(r,`PERMANENT = ${r}`),G(o,`SPOOL = ${o}`),G(A,`ACCOUNT = ${A}`),G(u,`DEFAULT MAP = ${u}`),G(S,"FALLBACK","NO FALLBACK"),G(B,f(B,"BEFORE")),G(O,f(O,"AFTER")),G(w,z),H=>b(`
 `+H.join(`,
 `))])([])},"getDatabaseOptions"),$=c(A=>A?A.alias?`"${A.name}" AS "${A.alias}"`:`"${A.name}"`:"","getKeyWithAlias");return{getTableName:E,getIndexName:P,getJournalingStrategy:f,getDefaultJournalTableName:N,getDatabaseOptions:v,getViewData:c(A=>Array.isArray(A)?A.reduce((u,r)=>{if(!r.tableName)return u.columns.push($(r)),u;let o=`"${r.dbName}"."${r.tableName}"`;return u.tables.includes(o)||u.tables.push(o),u.columns.push({statement:`${o}.${$(r)}`,isActivated:r.isActivated}),u},{tables:[],columns:[]}):{tables:[],columns:[]},"getViewData"),viewColumnsToString:p,shouldDropDefaultJournalTable:c(A=>!!(A.old.db_default_journal_db&&A.old.db_default_journal_table&&!A.new.db_default_journal_db&&!A.new.db_default_journal_table),"shouldDropDefaultJournalTable")}}});var Oe=V((at,Re)=>{"use strict";Re.exports=({_:d,tab:b,getJournalingStrategy:L,commentIfDeactivated:p,divideIntoActivatedAndDeactivated:E})=>{let P=c(i=>i?.percentUnit?`${i.freeSpaceValue} PERCENT`:i?.freeSpaceValue||"","getFreeSpaceValue"),N=c((i={})=>{if(i.mergeRatio==="SPECIFIC"&&i.specificRatio){let l=i.percentUnit?"PERCENT":"";return`MERGEBLOCKRATIO = ${i.specificRatio} ${l}`}return`${i.mergeRatio} MERGEBLOCKRATIO`},"getMergeBlockRatio"),f=c((i={})=>{if(i.blockSize==="SPECIFIC"&&i.specificSize){let l=i.units?` ${i.units}`:"";return i.blockSize+l}return`${i.blockSize} DATABLOCKSIZE`},"getDataBlockSize"),v=c((i,l)=>i==="SPECIFIC"&&l?`BLOCKCOMPRESSIONLEVEL = ${l}`:`BLOCKCOMPRESSIONLEVEL = ${i}`,"getBlockCompressionLevel"),$=c((i={})=>d.flow([m(!!i.blockCompressionType,`BLOCKCOMPRESSION = ${i.blockCompressionType}`),m(!!i.blockCompressionType,`BLOCKCOMPRESSIONALGORITHM = ${i.blockCompressionAlgorithm}`),m(!!i.blockCompressionLevel,v(i.blockCompressionLevel,i.specificBlockCompressionLevel))])([]),"getBlockCompression"),M=c(i=>["NO","CONCURRENT"].includes(i)?`WITH ${i} ISOLATED LOADING`:`WITH ISOLATED LOADING ${i}`,"getIsolatedLoading"),m=c((i,l,I=!1)=>g=>i?d.flatten([...g,l]):I?[...g,I]:g,"add"),A=c(i=>{let l=b(i.join(`,
`));return d.isEmpty(i)?l:`,
`+l},"formatTableOptions"),u=c(({FALLBACK:i,BEFORE_JOURNAL:l,AFTER_JOURNAL:I,DEFAULT_JOURNAL_TABLE:g,FREESPACE:h,TABLE_CHECKSUM:e,LOG:t,MAP:s,COLOCATE_USING:n,ISOLATED_LOADING:a,MERGE_BLOCK_RATIO:T,DATA_BLOCK_SIZE:y,BLOCK_COMPRESSION:_,QUEUE_TABLE:C,EXTERNAL_SECURITY:K,AUTHORIZATION_NAME:U},F=!1)=>d.flow([m(C,"QUEUE"),m(!!s,`MAP = ${s}${n?` COLOCATE USING ${n}`:""}`),m(i,"FALLBACK",F?"":"NO FALLBACK"),m(!!g,`WITH JOURNAL TABLE = ${g}`),m(t,"LOG",F?"":"NO LOG"),m(!!l,L(l,"BEFORE")),m(!!I,L(l,"AFTER")),m(!!e,`CHECKSUM = ${e}`),m(!!h?.freeSpaceValue,`FREESPACE = ${P(h)}`),m(!!T?.mergeRatio,N(T)),m(!!y?.blockSize,f(y)),m(!!_?.blockCompressionType,$(_)),m(!!a,M(a)),m(!!K,`EXTERNAL SECURITY ${K} TRUSTED${U?" "+U:""}`),A])([]),"getTableOptions"),r=c((i,l)=>{let I="";return I+=l?" ":"",I+=!i||i==="SECONDARY"?"INDEX":`${i} INDEX`,I},"getIndexType"),o=c((i=[])=>{if(d.isEmpty(i))return"";let l=E(i,g=>`"${g.name}"`);if(d.isEmpty(l.activatedItems))return l.deactivatedItems.join(", ");let I=l.deactivatedItems.length?p(l.deactivatedItems.join(", "),{isActivated:!1,isPartOfLine:!0}):"";return l.activatedItems.join(", ")+I},"getIndexKeys"),S=c(({indexMap:i,colocateUsing:l,indexFallback:I,checksum:g,blockCompression:h})=>d.flow([m(i,`MAP = ${i}${l?` COLOCATE USING ${l}`:""}`),m(I,"FALLBACK","NO FALLBACK"),m(g,`CHECKSUM = ${g}`),m(h,`BLOCKCOMPRESSION = ${h}`),A])([]),"getIndexOptions"),B=c(({isActivated:i,unique:l,indexType:I,all:g,indxKey:h,indxName:e,orderBy:t,orderKeys:s,loadIdentity:n})=>{if(d.isEmpty(h))return"";let a="";return a+=l?"UNIQUE":"",a+=r(I,l),a+=e?` "${e}"`:"",a+=g?" ALL":"",a+=d.isEmpty(h)?"":` ( ${o(h)} )`,a+=t?` ORDER BY ${t}`:"",a+=d.isEmpty(s)?"":` ( ${o(s)} )`,a+=n?` ${n}`:"",p(a,{isActivated:i})},"getTableInlineIndexStatement"),O=c(i=>i.map(B),"getTableInlineIndexStatements"),w=c(i=>{let l=i.find(I=>["PRIMARY","PRIMARY AMP"].includes(I.indexType)&&!d.isEmpty(I.indxKey));return l||{}},"findPrimaryIndex"),j=c(i=>i.filter(l=>(!l.indexType||l.indexType==="SECONDARY")&&!d.isEmpty(l.indxKey)),"filterSecondaryIndexes"),q=d.flow([w,B]),G=d.flow([j,O,d.compact]),D=c(i=>i.map(l=>{let I="";return I+=l.columnFormat?l.columnFormat:"",I+=l.name&&l.columnFormat?` "${l.name}"`:`"${l.name}"`,I+=l.autoCompression?` ${l.autoCompression}`:"",I}),"getPartitionKeys"),z=c((i={})=>{let l="PARTITION BY";return l+=i.partitionBy==="column"?" COLUMN":"",l+=i.partitioningExpression?` ${i.partitioningExpression}`:"",l+=i.compositePartitionKey?` (
	${D(i.compositePartitionKey).join(`,
	`)}
)`:"",l},"getPartitions");return{getTableOptions:u,getUsingOptions:c(({location:i,scanPercentage:l,pathPattern:I,manifest:g,tableFormat:h,rowFormat:e,storedAs:t,header:s,stripSpaces:n,stripEnclosingChar:a})=>d.flow([m(i,`LOCATION ( '${i}' )`),m(l,`SCANPCT = '${l}'`),m(I,`PATHPATTERN ( '${I}' )`),m(g,"MANIFEST ( 'TRUE' )","MANIFEST ( 'FALSE' )"),m(h,`TABLE_FORMAT ( '${h}' )`),m(e,`ROWFORMAT ( '${e}' )`),m(t,`STOREDAS ( '${t}' )`),m(s,"HEADER ( 'TRUE' )","STRIP_EXTERIOR_SPACES ( 'FALSE' )"),m(n,"STRIP_EXTERIOR_SPACES ( 'TRUE' )","STRIP_EXTERIOR_SPACES ( 'FALSE' )"),m(a,`STRIP_ENCLOSING_CHAR ( '${a}' )`),T=>b(T.join(`
	`))])([]),"getUsingOptions"),getInlineTableIndexes:c(i=>{let l=q(i.tableIndexes||[]),I=d.isEmpty(i.partitioning.partitioningExpression)&&d.isEmpty(i.partitioning.compositePartitionKey)?"":z(i.partitioning),g=G(i.tableIndexes||[]);if(!l&&!I&&d.isEmpty(g))return"";let h="";return h+=l||"",h+=I?`
`+I:"",`
`+b([h,...g].filter(Boolean).join(`,
`))},"getInlineTableIndexes"),getIndexOptions:S,getIndexKeys:o}}});var Ie=V((it,Ne)=>{"use strict";Ne.exports=d=>{let b=c((r,o)=>`${r}(${o})`,"addLength"),L=c((r,o)=>b(r,o),"addChildType"),p=c((r,o)=>`${r}(${o})`,"addPrecision"),E=c((r,o,S)=>d.isNumber(S)?`${r}(${o},${S})`:p(r,o),"addScalePrecision"),P=c((r,o,S)=>{let B=o?p(r,o):r;return S?`${B} WITH TIME ZONE`:B},"addTimezonePrecision"),N=c((r,o,S,B)=>{let O=r;return O+=o?`(${o})`:"",O+=S?` TO ${S}`:"",O+=B?`(${B})`:"",O},"addPrecisionAndToPrecision"),f=c(r=>["CHAR","CHARACTER","VARCHAR","CHAR VARYING","CHARACTER VARYING","VARGRAPHIC","CLOB","CHARACTER LARGE OBJECT","BYTE","VARBYTE","BLOB","ARRAY","JSON","XML","XMLTYPE","ST_GEOMETRY"].includes(r),"canHaveLength"),v=c(r=>["DECIMAL","DEC","NUMERIC","NUMBER"].includes(r),"canHavePrecisionAndScale"),$=c(r=>["INTERVAL YEAR","INTERVAL DAY","INTERVAL HOUR","INTERVAL MINUTE"].includes(r),"canHavePrecisionAndToPrecision"),M=c(r=>["INTERVAL SECOND"].includes(r),"canHavePrecisionAndSecondPrecision"),m=c(r=>["TIME","TIMESTAMP"].includes(r),"canHaveFractionalSecondPrecision"),A=c(r=>["PERIOD"].includes(r),"canHaveChildType"),u=c((r,o)=>{if(r=d.toUpper(r),A(r)){let S=u(o.childValueType,o);return L(r,S)}else{if(f(r)&&d.isNumber(o.length))return b(r,o.length);if($(r))return N(r,o.precision,o.toPrecision,o.fractSecPrecision);if(M(r))return E(r,o.precision,o.fractSecPrecision);if(v(r)&&d.isNumber(o.precision))return E(r,o.precision,o.scale);if(m(r))return P(r,o.fractSecPrecision,o.timezone)}return r},"decorateType");return{decorateType:u}}});var R=ne(),xe=ae(),be=ie(),Ge=ce(),Ve=de(),{joinActivatedAndDeactivatedStatements:Ye}=Ee();module.exports=(d,b,L)=>{let p=L.require("lodash"),{assignTemplates:E}=L.require("@hackolade/ddl-fe-utils"),{tab:P,commentIfDeactivated:N,checkAllKeysDeactivated:f,divideIntoActivatedAndDeactivated:v,hasType:$,clean:M,wrap:m,getDifferentProperties:A}=L.require("@hackolade/ddl-fe-utils").general,{generateConstraintsString:u,foreignKeysToString:r,foreignActiveKeysToString:o,createKeyConstraint:S}=Te()({_:p,commentIfDeactivated:N,checkAllKeysDeactivated:f,divideIntoActivatedAndDeactivated:v,assignTemplates:E}),B=pe()(p,M),{getTableName:O,getIndexName:w,getDatabaseOptions:j,getViewData:q,getJournalingStrategy:G,viewColumnsToString:D,shouldDropDefaultJournalTable:z}=Ce()(p,P,N),{getTableOptions:H,getUsingOptions:ee,getInlineTableIndexes:i,getIndexOptions:l,getIndexKeys:I}=Oe()({_:p,tab:P,getJournalingStrategy:G,commentIfDeactivated:N,checkAllKeysDeactivated:f,divideIntoActivatedAndDeactivated:v}),{decorateType:g}=Ie()(p),h=Ge(b.additionalOptions);return Ve({commentIfDeactivated:N})(h.applyDropStatements,{hydrateDatabase(e){return{databaseName:e.name,isActivated:e.isActivated,db_account:e.db_account,db_default_map:e.db_default_map,db_permanent_storage_size:e.db_permanent_storage_size,spool_files_size:e.spool_files_size,has_fallback:e.has_fallback,db_before_journaling_strategy:e.db_before_journaling_strategy,db_after_journaling_strategy:e.db_after_journaling_strategy,db_default_journal_table:e.db_default_journal_table,db_default_journal_db:e.db_default_journal_db}},hydrateTable({tableData:e,entityData:t,jsonSchema:s}){let n=t[0],a=t[2].Indxs;return{...e,tableIndexes:a,keyConstraints:B.getTableKeyConstraints(s),tableOptions:n.tableOptions,partitioning:n.partitioning,selectStatement:n.selectStatement}},hydrateView({viewData:e,entityData:t}){let s=t[0];return{name:e.name,tableName:e.tableName,keys:e.keys,recursive:s.recursive,selectStatement:s.selectStatement}},hydrateIndex(e){return e},hydrateCheckConstraint(e){let t=c(s=>`CHECK (${p.trim(s).replace(/^\(([\s\S]*)\)$/,"$1")})`,"buildExpression");return{name:e.chkConstrName||"",expression:t(e.constrExpression)}},hydrateViewColumn(e){return{name:e.name,tableName:e.entityName,alias:e.alias,isActivated:e.isActivated,dbName:e.dbName}},hydrateColumn({columnDefinition:e,jsonSchema:t}){return{name:e.name,type:e.type,childValueType:t.childValueType,primaryKey:B.isInlinePrimaryKey(t),unique:B.isInlineUnique(t),isActivated:e.isActivated,length:e.length,inlineLength:t.inlineLength,storageFormat:t.storageFormat,withSchema:t.withSchema,precision:e.precision,scale:e.scale,required:!e.nullable,uppercase:t.uppercase,caseSpecific:t.caseSpecific,format:t.format,default:e.default,fractSecPrecision:t.fractSecPrecision,toPrecision:t.toPrecision,characterSet:t.characterSet,autoColumn:t.autoColumn,timezone:t.timezone,compress:t.compress,compressUsing:t.compressUsing,decompressUsing:t.decompressUsing,methodSpecification:t.methodSpecification}},createDatabase({databaseName:e,isActivated:t,db_account:s,db_default_map:n,db_permanent_storage_size:a,spool_files_size:T,has_fallback:y,db_before_journaling_strategy:_,db_after_journaling_strategy:C,db_default_journal_table:K,db_default_journal_db:U}){let F=j({db_account:s,db_default_map:n,db_permanent_storage_size:a,spool_files_size:T,has_fallback:y,db_before_journaling_strategy:_,db_after_journaling_strategy:C,db_default_journal_table:K,db_default_journal_db:U}),x=N(E(R.createDatabase,{name:e,databaseOptions:F}),{isActivated:t}),Y=E(R.createSession,{name:e});return[x,Y].join(`
`)},createUdt(e,t){let s=e.characterSet?` CHARACTER SET ${e.characterSet}`:"";if(e.type==="OBJECT"){if(p.isEmpty(e.properties))return"";let n=e.properties.map(a=>{let T=`"${a.name}" ${g(a.type,a)}`;return T+=a.characterSet?` CHARACTER SET ${a.characterSet}`:"",T}).join(`,
	`);return N(E(R.createStructuredType,{typeName:`"${e.name}"`,columnDefinitions:n,methodSpecification:e.methodSpecification?`
	${e.methodSpecification}`:""}),{isActivated:e.isActivated})}else if(e.type==="ARRAY"){if(p.isEmpty(e.items))return"";let n=p.first(e.items),a=g(n.type,n);return N(E(R.createArrayType,{typeName:`"${e.name}"`,baseType:`${a} ${g(e.type,e)}`,default:e.default?`
	DEFAULT ${e.default}`:""}),{isActivated:e.isActivated})}return N(E(R.createDistinctType,{typeName:`"${e.name}"`,baseType:g(e.type,e)+s,methodSpecification:e.methodSpecification?`
	${e.methodSpecification}`:""}),{isActivated:e.isActivated})},createTable(e,t){let{name:s,dbData:n,columns:a,checkConstraints:T,foreignKeyConstraints:y,selectStatement:_,tableOptions:C}=e,K=H(C),U=O(s,n.databaseName),F=i(e),x=C.TABLE_PRESERVATION?`
	ON COMMIT ${C.TABLE_PRESERVATION}`:"",Y=p.isEmpty(T)?"":`,
		`+T.join(`,
		`),X=v(e.keyConstraints.map(S(R,t)),J=>J.statement),k=u(X,t),W=v(y,J=>J.statement),Z=u(W,t),Q=Ye({statements:a,indent:`
		`});if(C.FOREIGN_TABLE&&C.USING?.location){let J=ee(C.USING);return N(E(R.createForeignTable,{name:U,usingOptions:J,tableIndexes:F,tableOptions:K,column_definitions:Q,keyConstraints:k,foreignKeyConstraints:Z,checkConstraints:Y,tablePreservation:x}),{isActivated:t})}return C.ERROR_TABLE&&C.FOR_TABLE?N(E(R.createErrorTable,{tableName:U,targetDataTable:C.FOR_TABLE}),{isActivated:t}):p.isEmpty(_)?N(E(R.createTable,{name:U,tableIndexes:F,tableOptions:K,tableSet:C.SET_MULTISET?` ${C.SET_MULTISET}`:"",temporary:C.TEMPORARY_VOLATILE?` ${C.TEMPORARY_VOLATILE}`:"",traceTable:C.TRACE_TABLE?" TRACE":"",column_definitions:Q,keyConstraints:k,foreignKeyConstraints:Z,checkConstraints:Y,tablePreservation:x}),{isActivated:t}):N(E(R.createAsSelectTable,{tableSet:C.SET_MULTISET?` ${C.SET_MULTISET}`:"",temporary:C.TEMPORARY_VOLATILE?` ${C.TEMPORARY_VOLATILE}`:"",name:U,tableOptions:K,column_definitions:Q,keyConstraints:k,foreignKeyConstraints:Z,checkConstraints:Y,selectStatement:_,tableIndexes:F,tablePreservation:x}),{isActivated:t})},createView(e,t,s){let{deactivatedWholeStatement:n,selectStatement:a}=this.viewSelectStatement(e,s);return N(E(R.createView,{name:O(e.name,t.databaseName),recursive:e.recursive?" RECURSIVE":"",selectStatement:a,columnList:D(e.keys,s)}),{isActivated:!n})},viewSelectStatement(e,t=!0){let n=f(e.keys||[])||!t,{columns:a,tables:T}=q(e.keys),y=a.map(C=>C.statement).join(`,
		`);if(!n){let C=v(a,U=>U.statement),K=C.deactivatedItems.length?N(C.deactivatedItems.join(`,
		`),{isActivated:!1,isPartOfLine:!0}):"";y=C.activatedItems.join(`,
		`)+K}let _=p.trim(e.selectStatement)?p.trim(P(e.selectStatement)):E(R.viewSelectStatement,{tableName:T.join(", "),keys:y});return{deactivatedWholeStatement:n,selectStatement:_}},createIndex(e,t,s,n=!0){if(!["HASH","JOIN"].includes(t.indexType)||!t.indxName)return"";let T=l(t);if(t.indexType==="HASH"){if(p.isEmpty(t.indxKey))return"";let y=!p.isEmpty(t.orderKeys)&&!f(t.orderKeys||[]),_="";_+=t.orderBy?` ORDER BY ${t.orderBy}`:"",_+=!t.orderBy&&y?" ORDER BY":"",_+=y?` ( ${I(t.orderKeys)} )`:"";let C=f(t.indxKey||[]);return N(E(R.createHashIndex,{indexName:w(t.indxName,s.databaseName),tableName:O(e,s.databaseName),indexKeys:I(t.indxKey),orderBy:_,indexOptions:T}),{isActivated:n&&t.isActivated&&!C})}else if(t.indexType==="JOIN")return p.isEmpty(t.asSelect)?"":N(E(R.createJoinIndex,{indexName:w(t.indxName,s.databaseName),selectStatement:t.asSelect,indexOptions:T}),{isActivated:n&&t.isActivated});return""},createCheckConstraint(e){return E(R.checkConstraint,{name:e.name?`CONSTRAINT "${e.name}" `:"",expression:e.expression})},createCheckConstraintStatement(e,t,s){let n=O(e,s.databaseName);return E(R.alterTable,{tableName:n,tableOptions:"",alterStatement:E(R.addCheckConstraint,{name:m(t.name,'"','"'),expression:t.expression})})},dropCheckConstraint(e,t,s){let n=O(e,s.databaseName);return E(R.alterTable,{tableName:n,tableOptions:"",alterStatement:E(R.dropCheckConstraint,{name:m(t.name,'"','"')})})},alterCheckConstraint(e,{new:t,old:s},n){let a=O(e,n.databaseName),T=[];if(t.chkConstrName!==s.chkConstrName){let y=E(R.rename,{oldName:m(s.chkConstrName,'"','"'),newName:m(t.chkConstrName,'"','"')});T.push(y)}if(t.constrExpression!==s.constrExpression){let y=E(R.modifyCheckConstraint,{name:m(s.chkConstrName,'"','"'),expression:t.chkConstrName});T.push(y)}return E(R.alterTable,{tableName:a,tableOptions:"",alterStatement:`
`+P(T.join(`,
`))})},createForeignKeyConstraint({foreignKey:e,primaryTable:t,primaryKey:s,primaryTableActivated:n,foreignTableActivated:a,customProperties:T,isActivated:y},_){let C=f(s),K=f(e),U=!C&&!K&&n&&a&&y!==!1;return{statement:E(R.createForeignKeyConstraint,{checkOption:T.checkOption,primaryTable:O(t,_.databaseName),foreignKey:U?r(e):o(e),primaryKey:U?r(s):o(s)}),isActivated:U}},convertColumnDefinition(e){let t=this.hasType(e.type)?g(e.type,e):`"${e.type}"`,s=e.inlineLength?` INLINE LENGTH ${e.inlineLength}`:"",n=e.required?" NOT NULL":"",a=e.unique&&!e.nullable?" UNIQUE":"",T=e.primaryKey&&!e.nullable?" PRIMARY KEY":"",y=e.characterSet?` CHARACTER SET ${e.characterSet}`:"",_=e.storageFormat?` STORAGE FORMAT ${e.storageFormat}`:"",C=e.withSchema?` WITH SCHEMA ${e.withSchema}`:"",K=e.default?` DEFAULT ${e.default}`:"",U=e.uppercase?" UPPERCASE":"",F=e.caseSpecific?" CASESPECIFIC":"",x=e.format?` FORMAT '${e.format}'`:"",Y=e.autoColumn?" AUTO COLUMN":"",X=e.compress?` COMPRESS (${e.compress})`:"",k=e.compressUsing?` COMPRESS USING ${e.compressUsing}`:"",W=e.decompressUsing?` DECOMPRESS USING ${e.decompressUsing}`:"";return N(E(R.columnDefinition,{name:e.name,not_null:n,default:K,type:t,inlineLength:s,storageFormat:_,withSchema:C,uppercase:U,caseSpecific:F,format:x,autoColumn:Y,compress:X,compressUsing:k,decompressUsing:W,characterSet:y,inlineUniqueConstraint:a,inlinePKConstraint:T,inlineCheckConstraint:""}),{isActivated:e.isActivated})},hydrateDropDatabase(e){return{databaseName:e[0]?.name||""}},hydrateAlterDatabase({containerData:e,compModeData:t}){let s=e[0]||{},n=t.new.db_account!==t.old.db_account,a=t.new.db_default_map!==t.old.db_default_map,T=t.new.db_permanent_storage_size!==t.old.db_permanent_storage_size,y=t.new.spool_files_size!==t.old.spool_files_size,_=t.new.temporary_tables_size!==t.old.temporary_tables_size,C=t.new.has_fallback!==t.old.has_fallback,K=t.new.db_before_journaling_strategy!==t.old.db_before_journaling_strategy,U=t.new.db_after_journaling_strategy!==t.old.db_after_journaling_strategy,F=t.new.db_default_journal_db!==t.old.db_default_journal_db||t.new.db_default_journal_table!==t.old.db_default_journal_table,x=z(t);return{name:s.name||"",...n&&{db_account:s.db_account},...a&&{db_default_map:s.db_default_map},...T&&{db_permanent_storage_size:s.db_permanent_storage_size},...y&&{spool_files_size:s.spool_files_size},..._&&{temporary_tables_size:s.temporary_tables_size},...C&&{has_fallback:s.has_fallback},...K&&{db_before_journaling_strategy:s.db_before_journaling_strategy},...U&&{db_after_journaling_strategy:s.db_after_journaling_strategy},...F&&{db_default_journal_db:x?t.old.db_default_journal_db:s.db_default_journal_db,db_default_journal_table:x?t.old.db_default_journal_table:s.db_default_journal_table,dropDefaultJournalTable:x}}},hydrateDropTable({tableData:e,entityData:t}){let s=t[0];return{name:e.name,dbName:e.dbData.databaseName,temporary:s?.tableOptions?.TEMPORARY_VOLATILE==="GLOBAL TEMPORARY"}},hydrateAlterTable({name:e,newEntityData:t,oldEntityData:s}){let n=t[0]?.tableOptions||{},a=s[0]?.tableOptions||{},T=n.ERROR_TABLE!==a.ERROR_TABLE,y=n.FOR_TABLE!==a.FOR_TABLE,_=n.FOREIGN_TABLE!==a.FOREIGN_TABLE,C=n.SET_MULTISET!==a.SET_MULTISET,K=n.TEMPORARY_VOLATILE!==a.TEMPORARY_VOLATILE,U=n.QUEUE_TABLE!==a.QUEUE_TABLE,F=n.TRACE_TABLE!==a.TRACE_TABLE,x=n.EXTERNAL_SECURITY!==a.EXTERNAL_SECURITY,Y=n.AUTHORIZATION_NAME!==a.AUTHORIZATION_NAME,X=n.MAP!==a.MAP,k=n.COLOCATE_USING!==a.COLOCATE_USING,W=n.FALLBACK!==a.FALLBACK,Z=n.DEFAULT_JOURNAL_TABLE!==a.DEFAULT_JOURNAL_TABLE,Q=n.LOG!==a.LOG,J=n.BEFORE_JOURNAL!==a.BEFORE_JOURNAL,ye=n.AFTER_JOURNAL!==a.AFTER_JOURNAL,fe=n.TABLE_CHECKSUM!==a.TABLE_CHECKSUM,Le=n.ISOLATED_LOADING!==a.ISOLATED_LOADING,_e=n.TABLE_PRESERVATION!==a.TABLE_PRESERVATION,$e=n.FREESPACE?.freeSpaceValue!==a.FREESPACE?.freeSpaceValue||n.FREESPACE?.percentUnit!==a.FREESPACE?.percentUnit,ge=n.MERGE_BLOCK_RATIO?.mergeRatio!==a.MERGE_BLOCK_RATIO?.mergeRatio||n.MERGE_BLOCK_RATIO?.specificRatio!==a.MERGE_BLOCK_RATIO?.specificRatio||n.MERGE_BLOCK_RATIO?.percentUnit!==a.MERGE_BLOCK_RATIO?.percentUnit,Be=n.DATA_BLOCK_SIZE.blockSize!==a.DATA_BLOCK_SIZE?.blockSize||n.DATA_BLOCK_SIZE?.specificSize!==a.DATA_BLOCK_SIZE?.specificSize||n.DATA_BLOCK_SIZE?.units!==a.DATA_BLOCK_SIZE?.units,Pe=n.BLOCK_COMPRESSION?.blockCompressionType!==a.BLOCK_COMPRESSION?.blockCompressionType||n.BLOCK_COMPRESSION?.blockCompressionAlgorithm!==a.BLOCK_COMPRESSION?.blockCompressionAlgorithm||n.BLOCK_COMPRESSION?.blockCompressionLevel!==a.BLOCK_COMPRESSION?.blockCompressionLevel||n.BLOCK_COMPRESSION?.specificBlockCompressionLevel!==a.BLOCK_COMPRESSION?.specificBlockCompressionLevel,Ue=n.USING?.location!==a.USING?.location||n.USING?.scanPercentage!==a.USING?.scanPercentage||n.USING?.pathPattern!==a.USING?.pathPattern||n.USING?.manifest!==a.USING?.manifest||n.USING?.tableFormat!==a.USING?.tableFormat||n.USING?.rowFormat!==a.USING?.rowFormat||n.USING?.storedAs!==a.USING?.storedAs||n.USING?.header!==a.USING?.header||n.USING?.stripSpaces!==a.USING?.stripSpaces||n.USING?.stripEnclosingChar!==a.USING?.stripEnclosingChar;return{name:e,tableOptions:{...T&&{ERROR_TABLE:n.ERROR_TABLE},...y&&{FOR_TABLE:n.FOR_TABLE},..._&&{FOREIGN_TABLE:n.FOREIGN_TABLE},...C&&{SET_MULTISET:n.SET_MULTISET},...K&&{TEMPORARY_VOLATILE:n.TEMPORARY_VOLATILE},...U&&{QUEUE_TABLE:n.QUEUE_TABLE},...F&&{TRACE_TABLE:n.TRACE_TABLE},...x&&{EXTERNAL_SECURITY:n.EXTERNAL_SECURITY},...Y&&{AUTHORIZATION_NAME:n.AUTHORIZATION_NAME},...X&&{MAP:n.MAP},...k&&{COLOCATE_USING:n.COLOCATE_USING},...W&&{FALLBACK:n.FALLBACK},...Z&&{DEFAULT_JOURNAL_TABLE:n.DEFAULT_JOURNAL_TABLE},...Q&&{LOG:n.LOG},...J&&{BEFORE_JOURNAL:n.BEFORE_JOURNAL},...ye&&{AFTER_JOURNAL:n.AFTER_JOURNAL},...fe&&{TABLE_CHECKSUM:n.TABLE_CHECKSUM},...Le&&{ISOLATED_LOADING:n.ISOLATED_LOADING},..._e&&{TABLE_PRESERVATION:n.TABLE_PRESERVATION},...$e&&{FREESPACE:n.FREESPACE},...ge&&{MERGE_BLOCK_RATIO:n.MERGE_BLOCK_RATIO},...Be&&{DATA_BLOCK_SIZE:n.DATA_BLOCK_SIZE},...Pe&&{BLOCK_COMPRESSION:n.BLOCK_COMPRESSION},...Ue&&{USING:n.USING}}}},hydrateDropColumn({name:e}){return{name:e}},hydrateAlterColumn({newColumn:e,oldColumn:t,oldCompData:s,newCompData:n}){let a=A(e,t,["name","type"]),T={...e};return s.name!==n.name&&(T.oldName=s.name),s.type!==n.type&&(T.oldType=s.type),p.isEmpty(a)||(T.newOptions=a),T},hydrateDropView({tableData:e}){return{name:e.name,dbData:e.dbData}},hydrateAlterView({name:e,newEntityData:t,oldEntityData:s,viewData:n}){let a=this.hydrateView({viewData:{},entityData:t}),T=this.hydrateView({viewData:{},entityData:s}),y={};s[0]?.name!==t[0]?.name&&(y.oldName=s[0]?.name);let _=A(a,T);return{name:e,keys:n.keys,selectStatement:_.selectStatement||t[0]?.selectStatement,recursive:_.recursive||t[0]?.recursive,options:_,...y}},getDefaultType(e){return xe[e]},getTypesDescriptors(){return be},hasType(e){return $(be,e)},dropDatabase(e){return E(R.dropDatabase,e)},alterDatabase(e){let t=j(e);return E(R.modifyDatabase,{databaseName:e.name,databaseOptions:t})},dropTable(e){return E(R.dropTable,{name:O(e.name,e.dbName),temporary:e.temporary?"TEMPORARY ":""})},alterTable(e,t){let s=O(e.name,t.databaseName),n=H(e.tableOptions,!0);return p.trim(n)?E(R.alterTable,{tableName:s,tableOptions:n}):""},dropColumn(e,t,s){let n=O(e,s.databaseName);return E(R.alterTable,{tableName:n,tableOptions:"",alterStatement:E(R.dropColumn,{name:m(t.name,'"','"')})})},addColumn(e,t,s){let n=O(e,s.databaseName);return E(R.alterTable,{tableName:n,tableOptions:"",alterStatement:E(R.addColumn,{columnDefinition:this.convertColumnDefinition(t)})})},renameColumn(e,t,s){let n=O(e,s.databaseName);return E(R.alterTable,{tableName:n,tableOptions:"",alterStatement:E(R.rename,{oldName:m(t.oldName,'"','"'),newName:m(t.name,'"','"')})})},alterColumn(e,t,s){let n=O(e,s.databaseName),a=[];if(t.oldName&&t.oldType||t.oldType){let T=this.dropColumn(e,{name:t.name},s),y=this.addColumn(e,{...t,isActivated:!0},s);a.push(T,y)}else if(t.oldName&&!t.newOptions){let T=this.renameColumn(e,t,s);a.push(T)}else if(t.oldName&&t.newOptions){let T=this.renameColumn(e,t,s),y=this.addColumn(e,{...t,isActivated:!0},s);a.push(T,y)}else{let T=this.addColumn(e,{...t,isActivated:!0},s);a.push(T)}return N(a.join(`

`),{isActivated:t.isActivated})},dropIndex(e,t,s){if(!t.indxName)return"";let n=O(e,s.databaseName);if(["PRIMARY","PRIMARY AMP"].includes(t.indexType))return"";if(!t.indexType||t.indexType==="SECONDARY")return E(R.dropSecondaryIndex,{indexName:m(t.indxName,'"','"'),tableName:n});let a=t.indexType?` ${t.indexType}`:"",T=w(t.indxName,s.databaseName);return E(R.dropIndex,{indexName:T,indexType:a})},alterIndex(e,{new:t,old:s},n){return[this.dropIndex(e,s,n),this.createIndex(e,{...t,indxKey:t.indxKey.filter(a=>a.isActivated!==!1)},n)].join(`

`)},dropView({name:e,dbData:t}){let s=O(e,t.databaseName);return E(R.dropView,{viewName:s})},alterView(e,t){let s=p.isEmpty(e.options),n=O(e.name,t.databaseName);if(e.oldName&&s){let a=O(e.oldName,t.databaseName);return E(R.renameView,{oldViewName:a,newViewName:n})}else if(s)return"";return[this.dropView({name:e.oldName||e.name,dbData:t}),this.createView(e,t,!0)].join(`

`)}})};
